<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Arshatid</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@@eonasdan/tempus-dominus@6.9.4/dist/css/tempus-dominus.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Arshatid.styles.css" asp-append-version="true" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#008c44">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3">
            <div class="container-fluid">
                <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0" y="0" height="30" width="20" viewBox="0 0 87 129.4" xml:space="preserve" enable-background="new 0 0 87 129.4">
                        <style type="text/css">
                            .l0 {
                                fill: #008C44;
                            }

                            .l1 {
                                fill-rule: evenodd;
                                clip-rule: evenodd;
                                fill: #FFFFFF;
                            }

                            .l2 {
                                fill: #FFFFFF;
                            }
                        </style>
                        <path class="l0" d="M0.1 78.8V0.1H87v78.7c0 20.9-36.5 42.4-43.5 50.6C35.3 121.2 0.1 98.2 0.1 78.8" />
                        <path class="l1" d="M43.3 103.9l3.1 1.3v0.3c-0.1 0.1-2.2 1-4.2 1 -1.2 0-2.1 0-3 0v-0.5L43.3 103.9M30.4 88.1h1c2.5 0 3.7 2.2 3.7 4.6 0 0.3 0 0.8 0 0.9 0 0.2-0.8 2.7-3.3 2.7 -0.6 0-0.7 0-1.2 0 -1.4 0-1.7 0.9-1.7 1.7 0 1 2.8 1.1 2.8 1.1 1.4 0 2.1-0.1 2.1 0 0 0.4-0.7 1.7-0.7 2.7v1.3c0 0.1 0.2 0.9 0.6 1.8v0.3c-0.6 0.2-0.9 0.4-0.9 0.9 0 0.2 0.6 1.5 1.8 1.5 0.4 0 0.7 0 1.2 0 0.8 0 3 1.4 5.4 1.4 0.4 0 1.5 0 1.5 0 1-0.1 3.9-0.8 6-2.1 0.5-0.3 2.2-1.2 2.2-2 0-0.7-3.5-1.9-3.8-2 -0.3-0.2-3.3-1.6-4-1.6 -0.3 0-0.6 0.6-1 0.7 -1.7 0.8-4.7 2.6-5.5 2.6 -0.2 0-0.7-1.3-0.7-1.7v-1.3c0-1.9 1.6-4.8 6-6.6 1.2-0.5 3.9-1.5 6-1.5H51c0 0 4.3 0.3 4.3 1 0 0.8 0 1.1 0 2.9 0 7.5-6.6 12.7-11.6 12.9 -4 0.2-3.3 0-3.6 0 -2.7 0.1-7.6-2.1-8.8-3.1 -3.6-2.9-7.1-6.1-7.1-10.9C24.1 91.8 28.3 88.1 30.4 88.1zM50.4 82.5c0 0 3.2 2.1 5.1 5.9 2.2 4.5 0.5 3.5 4.3 4.3 0.9 0.2 1 0.7 1.6 0.4 0.1 0.1 6.1 2.3 6.1 2.3 0 0 2 1.1 2 1.6 0 0.2-1.9 1.4-3.7 3.1 -2.5 2.2-3.3 3.1-3.7 3.1 -0.5 0-0.9-1-1.8-3.1 -1-2.4-1.5-2.9-1.5-3.3 0-0.5 0.4-0.5 0.7-0.7 0.3 0.3 1.2 0.3 1.6 0.7 0.2 0.2 1.4 2.8 1.9 2.8 0.4 0 2.5-2.2 2.5-2.2 0-0.5-3.1-1.5-3.3-1.6 -2.7-0.8-3.6-1.1-3.7-1.1 -0.8 0-0.4 1-0.4 1.4v1.3c0 7.3-7.2 15-15.7 15.3 -0.6 0-1.3 0-3.2 0 0 0-6.3-0.7-11.3-5 -1.3-1.1-2.8-2.6-3.7-4.4 0 0-1.3-1.9-1.5-2.4 -0.9-2.4-0.6-2.9-0.9-3.2v-2.5c0-1.5 0.4-2 0.3-2.4 0.7-0.4 0.4-2.8 3.8-5.4 0 0 0.5-0.7 0.8-0.7 0.5 0 1.5-0.9 2.4-0.9 0.5 0 1.1 0 1.9 0 4.3 0 7 2.8 7 6.6 0 0.3-0.3 1.4 0 2.1 0 0 4.5-3 7.9-3.2 6.8-0.3 4 0 7.8 0 0.4 0 0.5 0 0.5-0.3 0 0-0.6-2-1.5-2.8h-0.3c-0.1 1.8-0.1 2.1-1.6 2.1 -0.8 0-1-0.7-1-1.4 0-0.5 0-4.9 0-5.8C49.7 83.3 49.9 83.1 50.4 82.5z" /><path class="l2" d="M85.8 59.3l-16.3-0.1C65 26.3 54.2 8 46.7 5.1c-2.9-1.1-5.4-0.5-5.9-0.3 -5.4 2.3-18.1 18.3-22.5 54.3l-16.6 0v2h26.7l-2.1 13.7H1.5v2h84.2v-1.9H61l-1.6-13.7h26.5V59.3zM29.1 75c3.4-25.1 7.7-48.4 14.5-48.8 7.1-0.4 13.2 33.2 15 48.8H29.1z" />
                    </svg>
                    Hulda - Arshatid
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
                    <ul class="navbar-nav flex-grow-1">
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Index">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-area="" asp-controller="Events" asp-action="Index">Viðburðir</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-area="" asp-controller="CostCenter" asp-action="Index">Cost Centers</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="container">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    <footer class="border-top footer text-muted">
        <div class="container">
            &copy; 2025 - Arshatid - <a asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>
        </div>
    </footer>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@@popperjs/core@2.11.6/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@@eonasdan/tempus-dominus@6.9.4/dist/js/tempus-dominus.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script>
        (function () {
          "use strict";

          // ---- helpers ----
          const GLOBAL = window.TD_DEFAULTS || {};
          const pad = n => String(n).padStart(2, "0");
          const toIsoLocal = d =>
            `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
          const pickBool = (v, fb) => (v == null ? fb : /^(true|1)$/i.test(String(v)));

          // parse 'yyyy-MM-ddTHH:mm' as LOCAL (no timezone shift)
          function parseIsoLocal(iso) {
            if (!iso) return null;
            const m = /^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})$/.exec(iso);
            if (!m) return null;
            return new Date(+m[1], +m[2] - 1, +m[3], +m[4], +m[5], 0, 0);
          }

          // Convert JS Date -> TD DateTime (support different builds)
          function toTD(jsDate) {
            if (!(jsDate instanceof Date) || Number.isNaN(jsDate.getTime())) return null;
            const TD = window.tempusDominus;
            try {
              if (TD?.DateTime?.fromJSDate) return TD.DateTime.fromJSDate(jsDate);
              if (TD?.DateTime?.convert)    return TD.DateTime.convert(jsDate);
              if (TD?.DateTime)             return new TD.DateTime(jsDate);
            } catch { /* ignore */ }
            return null;
          }

          // Find hidden partner for a visible input with id ..._display
          function hiddenFor(input) {
            if (input.id && input.id.endsWith("_display")) {
              const guess = document.getElementById(input.id.replace(/_display$/, "_value"));
              if (guess) return guess;
            }
            const sib = input.nextElementSibling;
            return (sib && sib.tagName === "INPUT" && sib.type === "hidden") ? sib : null;
          }

          // ---- init one field ----
          function initOne(input) {
            if (input.dataset.tdInit === "1") return;
            const hidden = hiddenFor(input);
            if (!hidden) return;

            const locale  = input.getAttribute("data-td-locale")         || GLOBAL.locale        || "is";
            const hour24  = input.getAttribute("data-td-hourcycle")      || GLOBAL.hourCycle     || "h23";
            const format  = input.getAttribute("data-td-display-format") || GLOBAL.displayFormat || "dd.MM.yyyy HH:mm";
            const seconds = pickBool(input.getAttribute("data-td-seconds"), GLOBAL.seconds ?? false);
            const step    = parseInt(input.getAttribute("data-td-step") ?? (GLOBAL.step ?? 1), 10);

            const picker = new tempusDominus.TempusDominus(input, {
              localization: { locale, hourCycle: hour24, format },
              stepping: step,
              display: {
                sideBySide: true,
                components: { calendar: true, clock: true, hours: true, minutes: true, seconds }
              }
            });

            // Seed TD internal state from hidden ISO, but swallow any TD quirks
            if (hidden.value) {
              const js = parseIsoLocal(hidden.value);
              const td = toTD(js);
              if (td) { try { picker.dates.setValue(td); } catch {/* ignore */} }
            }

            // Keep hidden ISO in sync on change
            input.addEventListener("change.td", e => {
              const raw = e?.detail?.date;
              // TD DateTime -> JS Date
              const js  = raw && typeof raw.toDate === "function" ? raw.toDate()
                        : raw?.jsDate ? raw.jsDate
                        : null;
              if (js instanceof Date && !Number.isNaN(js.getTime())) {
                hidden.value = toIsoLocal(js);
                hidden.dispatchEvent(new Event("input",  { bubbles: true }));
                hidden.dispatchEvent(new Event("change", { bubbles: true }));
              }
            });

            // ---- OPEN behavior (simple & robust) ----

            // A) Textbox: open on focus (this previously worked well)
            input.addEventListener("focus", () => { try { picker.show(); } catch {} });

            // B) Icon button: disable TD's built-in toggle and open ourselves
            if (input.id) {
              const target = "#" + input.id;
              document.querySelectorAll(
                `[data-td-toggle="datetimepicker"][data-td-target="${target}"]`
              ).forEach(btn => {
                // remove built-in toggler to avoid open→close flicker
                btn.removeAttribute("data-td-toggle");
                btn.removeAttribute("data-td-target");

                // keep focus on the textbox
                btn.addEventListener("mousedown", ev => {
                  ev.preventDefault();
                  input.focus();
                });

                // open once, no propagation games
                btn.addEventListener("click", ev => {
                  ev.preventDefault();
                  input.focus();
                  try { picker.show(); } catch {}
                });
              });
            }

            input.dataset.tdInit = "1";
          }

          // ---- init all ----
          function initAll() {
            document.querySelectorAll(".td-datetime").forEach(initOne);
          }

          if (document.readyState === "loading") document.addEventListener("DOMContentLoaded", initAll);
          else initAll();

          window.initAllTempusDominus = initAll;
        })();
    </script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
