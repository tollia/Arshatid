@model ArshatidPublic.Models.RegistrationViewModel
@{
    ViewData["Title"] = "Skráning";
    Layout = "_Layout_plain";
}

<p>
    <img src="~/img/CoverPhoto.jpg" class="img-fluid" alt="Event Cover Photo">
</p>

@* Show warning if user is not invited *@
@if (ViewBag.NotInvitedMessage is string notInv && !string.IsNullOrWhiteSpace(notInv))
{
    <div class="alert alert-warning">@notInv</div>
}

@* Otherwise show the form *@
@if (ViewBag.NotInvitedMessage == null)
{
    <div b-191jc0ugh8="" class="container" style="max-width: 1000px;">
        <main b-191jc0ugh8="" role="main" class="pb-3">
            <form asp-controller="Home" asp-action="SkraningUpsert" method="post" class="row g-3">
                <input type="hidden" name="jwt" value="@(Context.Items["jwt_token"] as string)" />

                <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                <h3>Heill sé þér @User.Identity.Name</h3>

                <div class="col-12">
                    <div class="form-check">
                        <input class="form-check-input" asp-for="Plus" />
                        <label class="form-check-label" asp-for="Plus"></label>
                    </div>
                </div>

                <div class="col-12">
                    <label class="form-label" asp-for="ArshatidCostCenterFk"></label>
                    <select class="form-select js-choices"
                            asp-for="ArshatidCostCenterFk"
                            asp-items="@(ViewBag.CostCenters as IEnumerable<SelectListItem>)"
                            data-placeholder="Veldu vinnustaðstað">
                        <option value="">Veldu kostnaðarstað</option>
                    </select>
                    <span class="text-danger" asp-validation-for="ArshatidCostCenterFk"></span>
                </div>

                <div class="col-12">
                    <label class="form-label" for="Alergies">Fæðuóþol</label>
                    <textarea class="form-control" id="Alergies" name="Alergies" rows="3">@Model.Alergies</textarea>
                    <span class="text-danger field-validation-valid" data-valmsg-for="Alergies" data-valmsg-replace="true"></span>
                </div>

                <div class="col-12">
                    <div class="form-check">
                        <input class="form-check-input" asp-for="Vegan" />
                        <label class="form-check-label" asp-for="Vegan"></label>
                    </div>
                </div>

                <div class="col-12">
                    <button type="submit" class="btn btn-success me-2">@((ViewBag.HasRegistration ?? false) ? "Breyta" : "Skrá")</button>

                    @* Separate post to Home/KemstEkki, keeping it inline *@
                    @if (ViewBag.HasRegistration ?? false)
                    {
                        <button type="submit"
                                class="btn btn-danger"
                                formaction='@Url.Action("KemstEkki", "Home")'
                                formmethod="post"
                                onclick="return confirm('Ertu alveg viss um að þú getir ekki verið með? Við höfum svo gaman af félagsskap þínum.');">
                            Kemst ekki
                        </button>
                    }
                </div>
            </form>
        </main>
    </div>
}

@section Styles {
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/choices.js@10.2.0/public/assets/styles/choices.min.css" />
}

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/choices.js@10.2.0/public/assets/scripts/choices.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.js-choices').forEach(function (el) {
                new Choices(el, {
                    searchEnabled: true,
                    shouldSort: false,
                    removeItemButton: false,
                    allowHTML: false,
                    placeholder: true,
                    placeholderValue: el.dataset.placeholder || 'Veldu…'
                });
            });
        });
    </script>
}
